<html>
    
    <head>
        <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
        <link type="text/css" href="css/redmond/jquery-ui-1.8.4.custom.css" rel="Stylesheet"
        />
        <script type="text/javascript" src="js/jquery-1.4.2.min.js"></script>
        <script type="text/javascript" src="js/jquery-ui-1.8.4.custom.min.js"></script>
			<style type="text/css">
			p.detail { color:EEC900;font-weight:bold;font-family:Calibri;font-size:48 }
			span.name { color:4682B4;font-weight:bold;font-family:Calibri;font-size:48 }
            html {
                height: 100%
            }

            body {
                height: 100%;
                margin: 0px;
                padding: 0px
            }
            #map{
				width: 100;
				height: 500px;
			}
            #container {
                width: 80%;
                /* this will create a container 80% of the browser width */
                /* height: 100% */
                margin: 0 auto;
                /* the auto margins (in conjunction with a width) center the page */
            }
			</style>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>		
        <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
		<script type ="text/javascript" src="v3_epoly.js"></script>
        <script type="text/javascript">
var NUM_ROUTES = 6;
var NUM_BUSES = 8;
		
var directionsService = new window.google.maps.DirectionsService();
var directionsDisplay = new Array(NUM_ROUTES);
var infoWindow = new google.maps.InfoWindow();
var panorama;
var panoramaBusFocus = -1;

function initialize() {
	chk_ab.checked = false;
	chk_c1.checked = false;
	chk_c2.checked = false;
	chk_e.checked = false;
	chk_nite.checked = false;
	chk_fast.checked = false;

	var UCM = new google.maps.LatLng(37.365696,-120.42482);
	var myOptions = {
		zoom: 13,
		center: UCM,
		mapTypeId: google.maps.MapTypeId.ROADMAP
	 };
	var panoramaOptions = {
		position: UCM,
		pov: {
			heading: 40,
			pitch: 10,
			zoom: 0
			}
	};
	
	panorama = new google.maps.StreetViewPanorama(document.getElementById("pano"), panoramaOptions);
	
	for (var i = 0; i < NUM_ROUTES; i++) {
		directionsDisplay[i] = new window.google.maps.DirectionsRenderer({markerOptions:
			{animation: google.maps.Animation.DROP},
			infoWindow: infoWindow});
	}
	
	map = new google.maps.Map(document.getElementById("map"), myOptions);
	map.setStreetView(panorama);
	
	google.maps.event.addListener(map, 'click',
		function(event){
			infoWindow.close();
			panoramaBusFocus = -1;
			panorama.setVisible(true);
			panorama.setPosition(event.latLng);
		});
	
	google.maps.event.addListener(map, 'rightclick',
		function(event){
			infoWindow.close();
			panoramaBusFocus = -1;
			panorama.setVisible(true);
			panorama.setPosition(event.latLng);
		});
	
	return map;
};

//for A-B line
 function initialize_ab(map) {
	var stops = 
	[
		{"Geometry":{"Latitude":37.366491,"Longitude":-120.424801}}, //kolligan_library
		{"Geometry":{"Latitude":37.363518,"Longitude":-120.430605}}, //emigrant_pass
		{"Geometry":{"Latitude":37.320237,"Longitude":-120.504889}},  //(No Marker) waypoint to continue hwy 59  
		{"Geometry":{"Latitude":37.374207,"Longitude":-120.57729}},  //castle_air
		{"Geometry":{"Latitude":37.33678542566877,"Longitude":-120.47805368900299}}, //bus_terminal
		{"Geometry":{"Latitude":37.363255,"Longitude":-120.429334}}, //scholars_lane
		{"Geometry":{"Latitude":37.36522, "Longitude":-120.426464}},  //muir_pass
		{"Geometry":{"Latitude":37.366498,"Longitude":-120.424774}} //kolligian_library
	] ;
	
	var busTimes = new Object();
	busTimes.startTime = [[5,50], [5,52], [6,13], [6,31], [6,41], [6,43], [6,50]];
	busTimes.interval = [[0,0], [1,0], [1,0], [1,0], [1,0], [1,0], [1,0], [1,0], [1,0], [1,0], [1,0], [1,25], [1,0], [1,0]];
	busTimes.start = [6,13];
	busTimes.end = [20,15];
	
	var isStop = new Array(7);
	isStop[2] = false;


	if (!window.route) {
		route_startUp(stops);
	}
	else {
		window.route.updateStops(stops);
	}
	
	directionsDisplay[0].setOptions({polylineOptions:
		{strokeColor: 'red', strokeWeight:5, strokeOpacity: 0.45}});
	
    window.route.loadMap(map, 0);
    window.route.fitBounds(map);
	window.route.calcRoute(map, isStop, busTimes, 'bus_red.png', 0, 0, 'A-B Line',
		'<a href="http://taps.ucmerced.edu/cattracks/ab-line" target="_blank">A-B Line</a>');

};

//for c1 line					
function initialize_c1(map) {
	var stops = 
	[
		{"Geometry":{"Latitude":37.315721,"Longitude":-120.504069}}, //granville_luxary
		{"Geometry":{"Latitude":37.317718,"Longitude":-120.499839}}, //walmart
		{"Geometry":{"Latitude":37.31782,"Longitude":-120.495064}}, //saveMart
		{"Geometry":{"Latitude":37.318225,"Longitude":-120.474111}}, //scaps
		{"Geometry":{"Latitude":37.315533,"Longitude":-120.469165}}, //Gst
		{"Geometry":{"Latitude":37.31788, "Longitude":-120.469186}}, //RiteAide
		{"Geometry":{"Latitude":37.326608,"Longitude":-120.469068}}, //GPortdr
		{"Geometry":{"Latitude":37.339421,"Longitude":-120.468628}}, //MercyHos
		{"Geometry":{"Latitude":37.363216,"Longitude":-120.429318}}, //ScholarLakeLot
		{"Geometry":{"Latitude":37.365041,"Longitude":-120.426303}}, //WellnessCenter
		{"Geometry":{"Latitude":37.366457,"Longitude":-120.424747}}, //KolLib
		{"Geometry":{"Latitude":37.363881,"Longitude":-120.430638}}, //EmigrantPass
		{"Geometry":{"Latitude":37.337835,"Longitude":-120.469186}}, //MercyHos2
		{"Geometry":{"Latitude":37.324432,"Longitude":-120.46932}}, //PortalPlaza
		{"Geometry":{"Latitude":37.315755,"Longitude":-120.469594}}, //SunStar
		{"Geometry":{"Latitude":37.317752,"Longitude":-120.47307}}, //MercedFloral
		{"Geometry":{"Latitude":37.318537,"Longitude":-120.494828}}, //AnnaLinen (savemart)
		{"Geometry":{"Latitude":37.318366,"Longitude":-120.499656}}, //PierOne (walmart)
		{"Geometry":{"Latitude":37.315721,"Longitude":-120.504069}} //granville_luxary loop
	] ;
	
	var busTimes = new Object();
	busTimes.startTime = [[6,45], [6,50], [6,52], [6,59], [7,01], [7,03], [7,05], [7,08],
		[7,15], [7,17], [7,28], [7,30], [7,37], [7,40], [7,42], [7,46], [7,53], [7,55], [8,05]];
	busTimes.startTime2 = [[7,25], [7,30], [7,32], [7,39], [7,41], [7,43], [7,45], [7,48],
		[7,55], [7,57], [8,08], [8,10], [8,17], [8,20], [8,22], [8,26], [8,33], [8,35], [8,45]]; 
	busTimes.interval = [[0,0], [1,20], [1,20], [1,20], [1,20], [1,20], [1,20], [1,20], [1,20], [1,20], [1,20]];
	busTimes.interval2 = [[0,0], [1,20], [1,20], [1,20], [1,20], [1,20], [1,20], [1,20], [1,20], [1,20], [1,20], [1,20]];
	busTimes.start = [6,45];
	busTimes.end = [21,25];
	busTimes.start2 = [7,25];
	busTimes.end2 = [23,37];
	

	
	var isStop = new Array(19);
	
    if (!window.route) {
		route_startUp(stops);
	}
	else {
		window.route.updateStops(stops);
	}
	
	directionsDisplay[1].setOptions({polylineOptions:
		{strokeColor: 'fuchsia', strokeWeight:5, strokeOpacity: 0.45}});
	
    window.route.loadMap(map, 1);
    window.route.fitBounds(map);
	window.route.calcRoute(map, isStop, busTimes, 'bus_purple.png', 1, 1, 'C1 Line',
		'<a href="http://taps.ucmerced.edu/cattracks/c1-gold-line" target="_blank">C1 Line</a>');
};


//for c2 line				
function initialize_c2(map) {
	var stops = 
	[
		{"Geometry":{"Latitude":37.334996,"Longitude":-120.486176}}, //village_landing
		{"Geometry":{"Latitude":37.339447,"Longitude":-120.486746}}, //(No Marker) waypoint for U-turn on R st.
		{"Geometry":{"Latitude":37.332346,"Longitude":-120.48651}}, //(No Marker) waypoint for turn right to W yosemite 
		{"Geometry":{"Latitude":37.334474,"Longitude":-120.495185}}, //el_redondo
		{"Geometry":{"Latitude":37.335642,"Longitude":-120.495274}}, //(No Marker) waypoint for U-turn El Redondo	
		{"Geometry":{"Latitude":37.332113,"Longitude":-120.497102}}, //(No Marker) 1st waypoint for right turn 	to hwy 59			
		{"Geometry":{"Latitude":37.331766,"Longitude":-120.504356}}, //(No Marker) 2nd waypoint for right turn 	to hwy 59	
		{"Geometry":{"Latitude":37.326265,"Longitude":-120.503323}}, //buena_vista
		{"Geometry":{"Latitude":37.32338,"Longitude":-120.485747}}, //merced_mall
		{"Geometry":{"Latitude":37.325157,"Longitude":-120.478233}}, //villages_apts
		{"Geometry":{"Latitude":37.334627, "Longitude":-120.477982}}, //bus_terminal
		{"Geometry":{"Latitude":37.342277,"Longitude":-120.480217}}, //ironstone_dr
		{"Geometry":{"Latitude":37.341477,"Longitude":-120.479818}}, //(No Marker) waypoint for U-turn back to ironstone dr	
		{"Geometry":{"Latitude":37.354019,"Longitude":-120.472464}}, //bellevue_ranch
		{"Geometry":{"Latitude":37.363216,"Longitude":-120.429318}}, //scholars_lane
		{"Geometry":{"Latitude":37.365344,"Longitude":-120.426668}}, //muir_pass
		{"Geometry":{"Latitude":37.366491,"Longitude":-120.424801}}, //kolligan_library
		{"Geometry":{"Latitude":37.363881,"Longitude":-120.430638}}, //emigrant_pass
		{"Geometry":{"Latitude":37.334996,"Longitude":-120.486176}} //village_landing loop
	] ;
	
	var busTimes = new Object();
	
	busTimes.startTime = [[6,30], [6,35], [6,40], [6,45], [6,47], [6,51], [6,53], [6,57], [7,03], [7,05], [7,19], [7,21], [7,35]];
	busTimes.startTime2 = [[6,45], [6,50], [6,55], [7,00], [7,02], [7,06], [7,08], [7,12], [7,18], [7,20], [7,34], [7,36], [7,50]];
	busTimes.interval = [[0,0], [1,05], [1,05], [1,05], [1,05], [1,05], [0,53], [1,05], [1,05], [1,05], [1,05], [1,05], [1,05], [1,31], [1,05]];
	busTimes.interval2 = [[0,0], [1,05], [1,05], [1,05], [1,05], [1,05], [1,08], [1,05], [1,05], [1,05], [1,05], [1,05]];
	busTimes.start = [6,30];
	busTimes.end = [22,31];
	busTimes.start2 = [6,45];
	busTimes.end2 = [19,20];
	
	//make waypoints equal false and use that info later to not display marker
	var isStop = new Array(18);
	isStop[1] = false;
	isStop[2] = false;
	isStop[4] = false;
	isStop[5] = false;
	isStop[6] = false;
	isStop[12] = false;
	
	if (!window.route) {
		route_startUp(stops);
	}
	else {
		window.route.updateStops(stops);
	}
	
	directionsDisplay[2].setOptions({polylineOptions:
		{strokeColor: 'lime', strokeWeight:5, strokeOpacity: 0.45}});
	
    window.route.loadMap(map, 2);
    window.route.fitBounds(map);
	window.route.calcRoute(map, isStop, busTimes, 'bus_green.png', 3, 2, 'C2 Line',
		'<a href="http://taps.ucmerced.edu/cattracks/c2-line-0" target="_blank">C2 Line</a>');
};


//for e line		
function initialize_e(map) {
	var stops = 
	[
		{"Geometry":{"Latitude":37.363216,"Longitude":-120.429318}}, //scholars_lane
		{"Geometry":{"Latitude":37.365215,"Longitude":-120.426539}}, //muir_pass
		{"Geometry":{"Latitude":37.366498,"Longitude":-120.424774}}, //kolligian_library
		{"Geometry":{"Latitude":37.363518,"Longitude":-120.430605}}, //emigrant_pass
		{"Geometry":{"Latitude":37.332081,"Longitude":-120.438094}}, //moraga_sub_west
		{"Geometry":{"Latitude":37.332195, "Longitude":-120.46055}}, //starbucks
		{"Geometry":{"Latitude":37.334676,"Longitude":-120.478027}}, //bus_terminal
		{"Geometry":{"Latitude":37.342277,"Longitude":-120.480217}}, //ironstone_dr
		{"Geometry":{"Latitude":37.341477,"Longitude":-120.479818}}, //(No Marker) waypoint for U-turn back to ironstone dr	
		{"Geometry":{"Latitude":37.354163,"Longitude":-120.472475}}, //bancroft_dr
		{"Geometry":{"Latitude":37.334996,"Longitude":-120.486176}}, // village_landing
		{"Geometry":{"Latitude":37.339447,"Longitude":-120.486746}}, //(No Marker) waypoint for U-turn on R st.
		{"Geometry":{"Latitude":37.332346,"Longitude":-120.48651}}, //(No Marker) waypoint for turn right to W yosemite 
		{"Geometry":{"Latitude":37.334179,"Longitude":-120.495236}}, //el_redondo
		{"Geometry":{"Latitude":37.335642,"Longitude":-120.495274}}, //(No Marker) waypoint for U-turn El Redondo	
		{"Geometry":{"Latitude":37.332113,"Longitude":-120.497102}}, //(No Marker) 1st waypoint for right turn 	to hwy 59			
		{"Geometry":{"Latitude":37.331766,"Longitude":-120.504356}}, //(No Marker) 2nd waypoint for right turn 	to hwy 59	
		{"Geometry":{"Latitude":37.326265,"Longitude":-120.503323}}, //buena_vista
		{"Geometry":{"Latitude":37.323305,"Longitude":-120.484904}}, //target
		{"Geometry":{"Latitude":37.325157,"Longitude":-120.478233}}, //villages_apt
		{"Geometry":{"Latitude":37.326977,"Longitude":-120.47836}}, //(No Marker) waypoint for U-turn from M st
		{"Geometry":{"Latitude":37.320272, "Longitude":-120.478373}}, //merced_mall_theatre
		{"Geometry":{"Latitude":37.306608, "Longitude":-120.477665}}, //(No Marker) To turn to amtrack
		{"Geometry":{"Latitude":37.307036,"Longitude":-120.476906}}, // amtrack
		{"Geometry":{"Latitude":37.300927,"Longitude":-120.481793}}, //hollywood_theatre
		{"Geometry":{"Latitude":37.315721,"Longitude":-120.504069}}, //granville_luxary
		{"Geometry":{"Latitude":37.316184,"Longitude":-120.497149}}, //(No Marker) turn to savemart stop	
		{"Geometry":{"Latitude":37.318084,"Longitude":-120.49491}}, //save_mart
		{"Geometry":{"Latitude":37.319767,"Longitude":-120.46912}}, //rite_aid
		{"Geometry":{"Latitude":37.33208,"Longitude":-120.468478}}, //millennium_sports
		{"Geometry":{"Latitude":37.331949,"Longitude":-120.436785}}, //moraga_sub_east
		{"Geometry":{"Latitude":37.363281,"Longitude":-120.429274}} //scholars_lane loop
	] ;
	
	var busTimes = new Object();
	busTimes.startTime = [[19,16], [19,18], [19,20], [19,22], [19,26], [19,30], [19,33], [19,35], [19,40], [19,45],
		[19,50], [19,55], [20,00], [20,01], [20,05], [20,12], [20,14], [20,26], [20,30], [20,34], [20,39], [20,42], [20,47]];
	busTimes.interval = [[0,0], [1,31], [1,41], [2,09]];
	busTimes.start = [19,16];
	busTimes.end = [01,57];
	
	var isStop = new Array(31);
	isStop[8]  = false;
	isStop[11]  = false;
	isStop[12] = false;
	isStop[14] = false;
	isStop[15] = false;
	isStop[16] = false;
	isStop[20] = false;
	isStop[22] = false;
	isStop[26] = false;
	
	if (!window.route) {
		route_startUp(stops);
	}
	else {
		window.route.updateStops(stops);
	}
	
	directionsDisplay[3].setOptions({polylineOptions:
		{strokeColor: '#FF6F00', strokeWeight:5, strokeOpacity: 0.45}});
	
    window.route.loadMap(map, 3);
    window.route.fitBounds(map);
	window.route.calcRoute(map, isStop, busTimes, 'bus_orange.png', 5, 3, 'E Line',
		'<a href="http://taps.ucmerced.edu/cattracks/e-line-0" target="_blank">E Line</a>');
};

//for nite line
function initialize_nite(map) {
	var stops = 
	[
		{"Geometry":{"Latitude":37.363216,"Longitude":-120.429318}}, //scholars_lane
		{"Geometry":{"Latitude":37.365344,"Longitude":-120.426668}}, //muir_pass
		{"Geometry":{"Latitude":37.366491,"Longitude":-120.424801}}, //kolligan_library
		{"Geometry":{"Latitude":37.363881,"Longitude":-120.430638}}, //emigrant_pass
		{"Geometry":{"Latitude":37.334996,"Longitude":-120.486176}}, //village_landing
		{"Geometry":{"Latitude":37.339447,"Longitude":-120.486746}}, //(No Marker) waypoint for U-turn on R st.
		{"Geometry":{"Latitude":37.332346,"Longitude":-120.48651}}, //(No Marker) waypoint for turn right to W yosemite 
		{"Geometry":{"Latitude":37.320272, "Longitude":-120.478373}}, //merced_mall_theatre
		{"Geometry":{"Latitude":37.318339,"Longitude":-120.497441}}, //applebee (in front of applebee, stopsign) 
		{"Geometry":{"Latitude":37.300917,"Longitude":-120.481909}}, //hollywood_theatres
		{"Geometry":{"Latitude":37.319618,"Longitude":-120.469173}}, //rite_aid
		{"Geometry":{"Latitude":37.3266,"Longitude":-120.468961}}, //la_hacienda
		{"Geometry":{"Latitude":37.363281,"Longitude":-120.429274}} //scholars_lane loop
	] ;
	
	var busTimes = new Object();
	busTimes.startTime = [[22,00], [22,02], [22,04], [22,06], [22,20], [22,28], [22,34], [22,46], [22,53], [22,57], [23,05]];
	busTimes.interval = [[0,0], [1,05], [1,10], [1,10]];
	busTimes.start = [22,00];
	busTimes.end = [02,35];
	
	var isStop = new Array(12);
	isStop[5]  = false;
	isStop[6]  = false;
	
	if (!window.route) {
		route_startUp(stops);
	}
	else {
		window.route.updateStops(stops);
	}
	
	directionsDisplay[4].setOptions({polylineOptions:
		{strokeColor: 'blue', strokeWeight:5, strokeOpacity: 0.45}});
	
    window.route.loadMap(map, 4);
    window.route.fitBounds(map);
	window.route.calcRoute(map, isStop, busTimes, 'bus_blue.png', 6, 4, 'NiteCat',
		'<a href="http://taps.ucmerced.edu/cattracks/nitecat-line" target="_blank">NiteCat</a>');
};


//for fast line
function initialize_fast(map) {
	var stops = 
	[
		{"Geometry":{"Latitude":37.332229,"Longitude":-120.438616}}, //moraga_sub_west
		{"Geometry":{"Latitude":37.332204,"Longitude":-120.453243}}, //university_surgery
		{"Geometry":{"Latitude":37.33217,"Longitude":-120.460507}}, //starbucks
		{"Geometry":{"Latitude":37.339297,"Longitude":-120.468796}}, //mercy_hospital
		{"Geometry":{"Latitude":37.353208,"Longitude":-120.471917}}, //bellevue_ranch
		{"Geometry":{"Latitude":37.352949,"Longitude":-120.474489}}, //(No Marker) 1st turn point to go to scholars lane
		{"Geometry":{"Latitude":37.363281,"Longitude":-120.429478}}, //scholars_lane
		{"Geometry":{"Latitude":37.365136,"Longitude":-120.426371}}, //muir_pass
		{"Geometry":{"Latitude":37.366602,"Longitude":-120.424965}}, //kolligain_library
		{"Geometry":{"Latitude":37.363881,"Longitude":-120.430638}}, //emigrant_pass
		{"Geometry":{"Latitude":37.354019,"Longitude":-120.472464}}, //bancroft_dr
		{"Geometry":{"Latitude":37.352949,"Longitude":-120.474489}}, //(No Marker) 1st turn point to go to mercy_hospital
		{"Geometry":{"Latitude":37.352629,"Longitude":-120.472777}}, //(No Marker) 2nd turn point to mercy hospital
		{"Geometry":{"Latitude":37.353876,"Longitude":-120.47046}}, //(No Marker) 3rd turn point to mercy hospital
		{"Geometry":{"Latitude":37.3385,"Longitude":-120.469165}}, //mercy_hosiptal
		{"Geometry":{"Latitude":37.332051,"Longitude":-120.465522}}, //millennium_sports
		{"Geometry":{"Latitude":37.331949,"Longitude":-120.45187}}, //university_surgery
		{"Geometry":{"Latitude":37.332057,"Longitude":-120.437909}}, //moraga_sub_east
		{"Geometry":{"Latitude":37.363255,"Longitude":-120.429334}}, //scholars_lane
		{"Geometry":{"Latitude":37.36522,"Longitude":-120.426464}}, //muir_pass
		{"Geometry":{"Latitude":37.366491,"Longitude":-120.424801}}, //kolligain_library
		{"Geometry":{"Latitude":37.363636,"Longitude":-120.430666}}, //emigrant_pass
		{"Geometry":{"Latitude":37.332236,"Longitude":-120.438974}} //moraga_sub_west loop
	] ;
	
	var busTimes = new Object();
	busTimes.startTime = [[7,00], [7,02], [7,05], [7,09], [7,13], [7,20], [7,22], [7,38], [7,40], [7,47], [7,51], [7,54], [7,57], [7,59], [8,04], [8,06], [8,13], [8,15], [8,20]];
	busTimes.interval = [[0,0], [1,20], [1,20], [1,20], [1,20], [1,20], [1,20], [1,20], [1,20], [1,20], [1,20], [1,20], [1,20]];
	busTimes.start = [7,00];
	busTimes.end = [00,20];
	
	
	var isStop = new Array(18);
	isStop[5] = false;
	isStop[11] = false;
	isStop[12] = false;
	isStop[13] = false;
	
	if (!window.route) {
		route_startUp(stops);
	}
	else {
		window.route.updateStops(stops);
	}
	
	directionsDisplay[5].setOptions({polylineOptions:
		{strokeColor: 'aqua', strokeWeight:5, strokeOpacity: 0.45}});
	
    window.route.loadMap(map, 5);
    window.route.fitBounds(map);
	window.route.calcRoute(map, isStop, busTimes, 'bus_cyan.png', 7, 5, 'FastCat',
		'<a href="http://taps.ucmerced.edu/cattracks/fastcat-0" target="_blank">FastCat</a>');
};



function route_startUp(stops) {
    if (!window.route) window.route = {
        updateStops: function (newStops) {
            stops = newStops;
        },
        // map: google map object
        // routeNumber: bus number
        loadMap: function (map, routeNumber) {
            var myOptions = {
                zoom: 13,
                center: new window.google.maps.LatLng(37.366572, -120.424876), // default to uc merced
                mapTypeId: window.google.maps.MapTypeId.ROADMAP
            };
            map.setOptions(myOptions);
            directionsDisplay[routeNumber].setMap(map);
        },
        fitBounds: function (map) {
            var bounds = new window.google.maps.LatLngBounds();

            // extend bounds for each record
            jQuery.each(stops, function (key, val) {
                var myLatlng = new window.google.maps.LatLng(val.Geometry.Latitude, val.Geometry.Longitude);
                bounds.extend(myLatlng);
            });
            map.fitBounds(bounds);
        },
        calcRoute: function (map, isStop, busTimes, busImage, busNumber, routeNumber, title, infoStr) {
            var batches = [];
            var itemsPerBatch = 10; // google API max = 10 - 1 start, 1 stop, and 8 waypoints
            var itemsCounter = 0;
            var wayptsExist = stops.length > 0;

            while (wayptsExist) {
                var subBatch = [];
                var subitemsCounter = 0;

                for (var j = itemsCounter; j < stops.length; j++) {
                    subitemsCounter++;
                    subBatch.push({
                        location: new window.google.maps.LatLng(stops[j].Geometry.Latitude, stops[j].Geometry.Longitude),
                        stopover: isStop[j]
                    });
                    if (subitemsCounter == itemsPerBatch)
                        break;
                }

                itemsCounter += subitemsCounter;
                batches.push(subBatch);
                wayptsExist = itemsCounter < stops.length;
                // If it runs again there are still points. Minus 1 before continuing to
                // start up with end of previous route leg
                itemsCounter--;
            }

            // now we should have a 2 dimensional array with a list of a list of waypoints
            var combinedResults;
            var unsortedResults = [{}]; // to hold the counter and the results themselves as they come back, to later sort
            var directionsResultsReturned = 0;

            for (var k = 0; k < batches.length; k++) {
                var lastIndex = batches[k].length - 1;
                var start = batches[k][0].location;
                var end = batches[k][lastIndex].location;

                // trim first and last entry from array
                var waypts = [];
                waypts = batches[k];
                waypts.splice(0, 1);
                waypts.splice(waypts.length - 1, 1);

                var request = {
                    origin: start,
                    destination: end,
                    waypoints: waypts,
                    travelMode: window.google.maps.TravelMode.DRIVING
                };
                (function (kk) {
                    directionsService.route(request, function (result, status) {
                        if (status == window.google.maps.DirectionsStatus.OK) {

                            var unsortedResult = { order: kk, result: result };
                            unsortedResults.push(unsortedResult);

                            directionsResultsReturned++;

                            if (directionsResultsReturned == batches.length) // we've received all the results. put to map
                            {
                                // sort the returned values into their correct order
                                unsortedResults.sort(function (a, b) { return parseFloat(a.order) - parseFloat(b.order); });
                                var count = 0;
                                for (var key in unsortedResults) {
                                    if (unsortedResults[key].result != null) {
                                        if (unsortedResults.hasOwnProperty(key)) {
                                            if (count == 0) // first results. new up the combinedResults object
                                                combinedResults = unsortedResults[key].result;
                                            else {
                                                // only building up legs, overview_path, and bounds in my consolidated object. This is not a complete
                                                // directionResults object, but enough to draw a path on the map, which is all I need
                                                combinedResults.routes[0].legs = combinedResults.routes[0].legs.concat(unsortedResults[key].result.routes[0].legs);
                                                combinedResults.routes[0].overview_path = combinedResults.routes[0].overview_path.concat(unsortedResults[key].result.routes[0].overview_path);

                                                combinedResults.routes[0].bounds = combinedResults.routes[0].bounds.extend(unsortedResults[key].result.routes[0].bounds.getNorthEast());
                                                combinedResults.routes[0].bounds = combinedResults.routes[0].bounds.extend(unsortedResults[key].result.routes[0].bounds.getSouthWest());
                                            }
                                            count++;
                                        }
                                    }
                                }
                                directionsDisplay[routeNumber].setDirections(combinedResults);
								startAnimation(map, combinedResults.routes[0], busTimes, busImage, busNumber, title, infoStr);
								
								if (busNumber == 1 || busNumber == 3) {
									startAnimation(map, combinedResults.routes[0], busTimes, busImage, busNumber + 1, title + ' 2', infoStr);
								}
                            }
                        }
                    });
                })(k);
            }
        }
    };
}

/* Animation functions. */
var bus = new Array(NUM_BUSES);
var timer = new Array(NUM_BUSES);

function startAnimation(map, route, busTimes, busImage, busNumber, title, infoStr) {
	var date = new Date();
	
	if (busNumber == 2 || busNumber == 4) {
		// Check if it is the correct day for the route.
		if (busNumber == 6 && date.getDay() <= 5) {
			if (date.getDay == 5 && date.getHours() <= busTimes.start2[0]) {
				if (date.getHours() < busTimes.start2[0] || 
						(date.getHours() == busTimes.start2[0] && date.getMinutes < busTimes.start2[1])) {
					return;
				}
			}
			
			else if (date.getDay == 0 && date.getHours() >= busTimes.end2[0]) {
				if (date.getHours() > busTimes.end2[0] || 
						(date.getHours() == busTimes.end2[0] && date.getMinutes > busTimes.end2[1])) {
					return;
				}
			}
			
			else {
				return;
			}
		}
		else if (date.getDay() <= 1 || date.getDay() == 6) {
			if (date.getDay() == 1 && date.getHours() <= busTimes.start2[0]) {
				if (date.getHours() < busTimes.start2[0] || 
						(date.getHours() == busTimes.start2[0] && date.getMinutes < busTimes.start2[1])) {
					return;
				}
			}
			if (busNumber == 5 || busNumber == 7) {
				if (date.getDay == 6 && date.getHours() >= busTimes.end2[0]) {
					if (date.getHours() > busTimes.end2[0] || 
							(date.getHours() == busTimes.end2[0] && date.getMinutes > busTimes.end2[1])) {
						return;
					}
				}
			}
			else {
				return;
			}
		}
		
		// Check if it is the correct time for the route.
		if (busTimes.start2[0] > busTimes.end2[0]) {
			if ( !(date.getHours() >= busTimes.start2[0] && date.getHours() <= 23) &&
				!(date.getHours() >= 0 && date.getHours() <= busTimes.end2[0])) {
				return;
			}
		}
		else if (busTimes.start2[0] < busTimes.end2[0]) {
			if (!(date.getHours() >= busTimes.start2[0] && date.getHours() <= busTimes.end2[0])) {
				return;
			}
		}
		
		// Check the minutes too.
		if (date.getHours() == busTimes.start2[0]) {
			if (date.getMinutes() < busTimes.start2[1]) {
				return;
			}
		}
		else if (date.getHours() == busTimes.end2[0]) {
			if (date.getMinutes() > busTimes.end2[1]) {
				return;
			}
		}
		
		var legs = route.legs;
		var busRoute = new google.maps.Polyline({
			path: []
		});
		
		var busIcon =  new google.maps.MarkerImage(busImage,
			new google.maps.Size(32,32),
			new google.maps.Point(0,0),
			new google.maps.Point(16,16));
		
		for (var i = 0; i < legs.length; i++) {
			var steps = legs[i].steps;
			
			for (var j = 0; j < steps.length; j++) {
				var next = steps[j].path;
				
				for (var k = 0; k < next.length; k++) {
					busRoute.getPath().push(next[k]);
				}
			}
		}
		
		var end = busRoute.Distance();
		
		bus[busNumber] = new google.maps.Marker({
			position: busRoute.getPath().getAt(0),
			map: map,
			title: title,
			animation: google.maps.Animation.DROP,
			icon: busIcon
		});
		
		google.maps.event.addListener(bus[busNumber], 'click', function() {
			infoWindow.setContent(infoStr);
			infoWindow.open(map, bus[busNumber]);
			panoramaBusFocus = busNumber;
		});
		
		google.maps.event.addListener(bus[busNumber], 'rightclick', function() {
			infoWindow.setContent(infoStr);
			infoWindow.open(map, bus[busNumber]);
			panoramaBusFocus = busNumber;
		});
		
		var legNum = 0;
		var distanceTraveled = 0;
		var distance = 0;
		var interval = 0;
		
		for (var i = 0; i <= busTimes.startTime2.length; i++) {
			var addHours = 0;
			var addMinutes = 0;
			
			for (var j = 0; j <= interval; j++) {
				addHours += busTimes.interval2[j][0];
				addMinutes += busTimes.interval2[j][1];
			}
			
			var startTimeHours = busTimes.startTime2[i][0] + addHours;
			var startTimeMinutes = busTimes.startTime2[i][1] + addMinutes;
			
			while (startTimeMinutes > 59) {
				startTimeMinutes -= 60;
				startTimeHours++;
			}
			while (startTimeHours > 23) {
				startTimeHours -= 24;
			}
			
			if (date.getHours() == startTimeHours) {
				if (startTimeMinutes >= date.getMinutes()) {
					if (i != 0) {
						var prevStopTimeSec = busTimes.startTime2[i-1][0] * 3600
							+ busTimes.startTime2[i-1][1] * 60;
						var nextStopTimeSec = busTimes.startTime2[i][0] * 3600
							+ busTimes.startTime2[i][1] * 60;
						
						var timeDifferenceSec = nextStopTimeSec - prevStopTimeSec;
						
						var timePastPrevStopSec = (date.getMinutes() * 60 + date.getSeconds())
							- (startTimeMinutes * 60);
						
						var ratio = timePastPrevStopSec / timeDifferenceSec;
						
						distance += ratio * legs[legNum].distance.value;
					}
					else {
						var prevStopTimeSec = busTimes.startTime2[busTimes.startTime2.length-1][0] * 3600
							+ busTimes.startTime2[busTimes.startTime2.length-1][1] * 60;
						var nextStopTimeSec = busTimes.startTime2[0][0] * 3600
							+ busTimes.startTime2[0][1] * 60
							+ busTimes.interval2[1][0] * 3600
							+ busTimes.interval2[1][1] * 60;
						
						var timeDifferenceSec = nextStopTimeSec - prevStopTimeSec;
						
						var timePastPrevStopSec = (date.getMinutes() * 60 + date.getSeconds())
							- (startTimeMinutes * 60);
							
						var ratio = timePastPrevStopSec / timeDifferenceSec;
						
						distance += ratio * legs[legNum].distance.value;
					}
					
					break;
				}
			}
			
			if (i == busTimes.startTime2.length-1) {
				i = -1;
				legNum = 0;
				distanceTraveled = 0;
				distance = 0;
				interval++;
				
				continue;
			}
			
			if (i != 0) {
				distanceTraveled += legs[legNum].distance.value;
				distance += legs[legNum].distance.value;
				legNum++;
			}
		}
		
		timer[busNumber] = setTimeout(function() {
			animate(bus[busNumber], busRoute, legs, legNum, distanceTraveled,
				busTimes, busNumber, distance, end);
			}, 0);
	}
	
	else {
		// Check if it is the correct day for the route.
		if (busNumber == 6 && date.getDay() <= 5) {
			if (date.getDay == 5 && date.getHours() <= busTimes.start[0]) {
				if (date.getHours() < busTimes.start[0] || 
						(date.getHours() == busTimes.start[0] && date.getMinutes < busTimes.start[1])) {
					return;
				}
			}
			
			else if (date.getDay == 0 && date.getHours() >= busTimes.end[0]) {
				if (date.getHours() > busTimes.end[0] || 
						(date.getHours() == busTimes.end[0] && date.getMinutes > busTimes.end[1])) {
					return;
				}
			}
			
			else {
				return;
			}
		}
		else if (date.getDay() <= 1 || date.getDay() == 6) {
			if (date.getDay() == 1 && date.getHours() <= busTimes.start[0]) {
				if (date.getHours() < busTimes.start[0] || 
						(date.getHours() == busTimes.start[0] && date.getMinutes < busTimes.start[1])) {
					return;
				}
			}
			if (busNumber == 5 || busNumber == 7) {
				if (date.getDay == 6 && date.getHours() >= busTimes.end[0]) {
					if (date.getHours() > busTimes.end[0] || 
							(date.getHours() == busTimes.end[0] && date.getMinutes > busTimes.end[1])) {
						return;
					}
				}
			}
			else {
				return;
			}
		}
		
		// Check if it is the correct time for the route.
		if (busTimes.start[0] > busTimes.end[0]) {
			if ( !(date.getHours() >= busTimes.start[0] && date.getHours() <= 23) &&
				!(date.getHours() >= 0 && date.getHours() <= busTimes.end[0])) {
				return;
			}
		}
		else if (busTimes.start[0] < busTimes.end[0]) {
			if (!(date.getHours() >= busTimes.start[0] && date.getHours() <= busTimes.end[0])) {
				return;
			}
		}
		
		// Check the minutes too.
		if (date.getHours() == busTimes.start[0]) {
			if (date.getMinutes() < busTimes.start[1]) {
				return;
			}
		}
		else if (date.getHours() == busTimes.end[0]) {
			if (date.getMinutes() > busTimes.end[1]) {
				return;
			}
		}
		
		var legs = route.legs;
		var busRoute = new google.maps.Polyline({
			path: []
		});
		
		var busIcon =  new google.maps.MarkerImage(busImage,
			new google.maps.Size(32,32),
			new google.maps.Point(0,0),
			new google.maps.Point(16,16));
		
		for (var i = 0; i < legs.length; i++) {
			var steps = legs[i].steps;
			
			for (var j = 0; j < steps.length; j++) {
				var next = steps[j].path;
				
				for (var k = 0; k < next.length; k++) {
					busRoute.getPath().push(next[k]);
				}
			}
		}
		
		var end = busRoute.Distance();
		
		bus[busNumber] = new google.maps.Marker({
			position: busRoute.getPath().getAt(0),
			map: map,
			title: title,
			animation: google.maps.Animation.DROP,
			icon: busIcon
		});
		
		google.maps.event.addListener(bus[busNumber], 'click', function() {
			infoWindow.setContent(infoStr);
			infoWindow.open(map, bus[busNumber]);
			panoramaBusFocus = busNumber;
		});
		
		google.maps.event.addListener(bus[busNumber], 'rightclick', function() {
			infoWindow.setContent(infoStr);
			infoWindow.open(map, bus[busNumber]);
			panoramaBusFocus = busNumber;
		});
		
		var legNum = 0;
		var distanceTraveled = 0;
		var distance = 0;
		var interval = 0;
		
		for (var i = 0; i <= busTimes.startTime.length; i++) {
			var addHours = 0;
			var addMinutes = 0;
			
			for (var j = 0; j <= interval; j++) {
				addHours += busTimes.interval[j][0];
				addMinutes += busTimes.interval[j][1];
			}
			
			var startTimeHours = busTimes.startTime[i][0] + addHours;
			var startTimeMinutes = busTimes.startTime[i][1] + addMinutes;
			
			while (startTimeMinutes > 59) {
				startTimeMinutes -= 60;
				startTimeHours++;
			}
			while (startTimeHours > 23) {
				startTimeHours -= 24;
			}
			
			if (date.getHours() == startTimeHours) {
				if (startTimeMinutes >= date.getMinutes()) {
					if (i != 0) {
						var prevStopTimeSec = busTimes.startTime[i-1][0] * 3600
							+ busTimes.startTime[i-1][1] * 60;
						var nextStopTimeSec = busTimes.startTime[i][0] * 3600
							+ busTimes.startTime[i][1] * 60;
						
						var timeDifferenceSec = nextStopTimeSec - prevStopTimeSec;
						
						var timePastPrevStopSec = (date.getMinutes() * 60 + date.getSeconds())
							- (startTimeMinutes * 60);
						
						var ratio = timePastPrevStopSec / timeDifferenceSec;
						
						distance += ratio * legs[legNum].distance.value;
					}
					else {
						var prevStopTimeSec = busTimes.startTime[busTimes.startTime.length-1][0] * 3600
							+ busTimes.startTime[busTimes.startTime.length-1][1] * 60;
						var nextStopTimeSec = busTimes.startTime[0][0] * 3600
							+ busTimes.startTime[0][1] * 60
							+ busTimes.interval[1][0] * 3600
							+ busTimes.interval[1][1] * 60;
						
						var timeDifferenceSec = nextStopTimeSec - prevStopTimeSec;
						
						var timePastPrevStopSec = (date.getMinutes() * 60 + date.getSeconds())
							- (startTimeMinutes * 60);
							
						var ratio = timePastPrevStopSec / timeDifferenceSec;
						
						distance += ratio * legs[legNum].distance.value;
					}
					
					break;
				}
			}
			
			if (i == busTimes.startTime.length-1) {
				i = -1;
				legNum = 0;
				distanceTraveled = 0;
				distance = 0;
				interval++;
				
				continue;
			}
			
			if (i != 0) {
				distanceTraveled += legs[legNum].distance.value;
				distance += legs[legNum].distance.value;
				legNum++;
			}
		}
		
		timer[busNumber] = setTimeout(function() {
			animate(bus[busNumber], busRoute, legs, legNum, distanceTraveled,
				busTimes, busNumber, distance, end);
			}, 0);
	}
}

function stopAnimation(busNumber) {
	bus[busNumber].setMap(null);
	clearTimeout(timer[busNumber]);
}

function animate(marker, route, legs, legNum, distanceTraveled,
	busTimes, busNumber, distance, end) {
	var stepSize;		// meters
	var tickrate = 100;	// milliseconds
	
	if (distance > end) {
		distance = 0;
		distanceTraveled = 0;
		legNum = 0;
	}
	
	var position = route.GetPointAtDistance(distance);
	
	marker.setPosition(position);
	
	if (distance >= legs[legNum].distance.value + distanceTraveled) {
		distanceTraveled += legs[legNum].distance.value;
		legNum++;
		
		marker.setAnimation(google.maps.Animation.BOUNCE);
		
		var leg = legs[legNum];
		
		stepSize = leg.distance.value / (leg.duration.value * 10);
		
		if (panoramaBusFocus == busNumber) {
			panorama.setVisible(true);
			panorama.setPosition(position);
		}
		
		tickrate = 15000;
		
		timer[busNumber] = setTimeout(function() {
			marker.setAnimation(null);
			animate(marker, route, legs, legNum, distanceTraveled,
				busTimes, busNumber, distance + stepSize, end);
			}, tickrate);
	}
	
	else {
		var leg = legs[legNum];
		
		stepSize = leg.distance.value / (leg.duration.value * 10);
		
		if (panoramaBusFocus == busNumber) {
			panorama.setVisible(true);
			panorama.setPosition(position);
		}
		
		timer[busNumber] = setTimeout(function() {
			animate(marker, route, legs, legNum, distanceTraveled,
				busTimes, busNumber, distance + stepSize, end);
			}, tickrate);
	}
}

$(window).focus(function(){
	if(chk_ab.checked) {
		initialize_ab(map);
	} 
	if(chk_c1.checked) {
		initialize_c1(map);
	} 
	if(chk_c2.checked) {
		initialize_c2(map);
	}
	if(chk_e.checked) {
		initialize_e(map);
	}
	if(chk_nite.checked) {
		initialize_nite(map);
	}
	if(chk_fast.checked) {
		initialize_fast(map);
	}
});

$(window).blur(function(){
		if(chk_ab.checked) {
			stopAnimation(0);
		}
		if(chk_c1.checked) {
			stopAnimation(1);
			stopAnimation(2);
		}
		if(chk_c2.checked) {
			stopAnimation(3);
			stopAnimation(4);
		}
		if(chk_e.checked) {
			stopAnimation(5);
		}
		if(chk_nite.checked) {
			stopAnimation(6);
		}
		if(chk_fast.checked) {
			stopAnimation(7);
		}
});
        </script>
    </head>
	<body onload="var map = initialize()"> 


	<script type="text/javascript"> 




function lineXOR(obj, map) {

	if(obj.checked == true) {
		if(obj.id == 'chk_ab') {
		initialize_ab(map);
		} else if(obj.id == 'chk_c1') {
		initialize_c1(map);
		} else if(obj.id == 'chk_c2') {
		initialize_c2(map);
		} else if(obj.id == 'chk_e') {
		initialize_e(map);
		} else if(obj.id == 'chk_nite') {
		initialize_nite(map);
		} else if(obj.id == 'chk_fast') {
		initialize_fast(map);
		}
	}
	
	else {
		if(obj.id == 'chk_ab') {
			directionsDisplay[0].setMap(null);
			stopAnimation(0);
		} else if(obj.id == 'chk_c1') {
			directionsDisplay[1].setMap(null);
			stopAnimation(1);
			stopAnimation(2);
		} else if(obj.id == 'chk_c2') {
			directionsDisplay[2].setMap(null);
			stopAnimation(3);
			stopAnimation(4);
		} else if(obj.id == 'chk_e') {
			directionsDisplay[3].setMap(null);
			stopAnimation(5);
		} else if(obj.id == 'chk_nite') {
			directionsDisplay[4].setMap(null);
			stopAnimation(6);
		} else if(obj.id == 'chk_fast') {
			directionsDisplay[5].setMap(null);
			stopAnimation(7);
		}
	}
};

</script> 
		<body bgcolor=#F4F0EC>
		<div style="text-align: center;">
		<p class="detail"> Cat<span class="name">Tracker</span> </p></div>

		</span> 
             <div id="map" style="width:75%; height:450px; padding-right: 250px;float: right" ></div>
             <div id="pano" style="width: 75%; height:300px; padding-right: 250px; float: right" ></div><br>
			 <br>
				 <p style = "float: right" align="center" >CatTracker made by Raymond Lee and Allen Vu.</p>
        
         </div>
		<div style="background: none repeat scroll 0% 0% rgb(244, 240, 236); padding: 2px 2px; text-align: center;"> 
		 </div>
		<span style="font-size:large;"> 

				Lines: <br>
				<input type="checkbox" name="chk_ab" id="chk_ab" value="1" onclick="lineXOR(this, map);"/><label for="chk_ab" <p style="color: red">A-B</label><br>
				<input type="checkbox" name="chk_c1" id="chk_c1" value="2" onclick="lineXOR(this, map);"/><label for="chk_c1"<p style="color: fuchsia" >C-1</label><br>
				<input type="checkbox" name="chk_c2" id="chk_c2" value="4" onclick="lineXOR(this, map);"/><label for="chk_c2" <p style="color: lime">C-2</label><br>
				<input type="checkbox" name="chk_e" id="chk_e" value="6" onclick="lineXOR(this, map);"/><label for="chk_e" <p style="color: FF6F00" >E</label><br>
				<input type="checkbox" name="chk_nite" id="chk_nite" value="8" onclick="lineXOR(this, map);"/><label for="chk_nite" <p style="color: blue" >Nite-Cat</label><br>
				<input type="checkbox" name="chk_fast" id="chk_fast" value="10" onclick="lineXOR(this, map);"/><label for="chk_fast" <p style="color: aqua" >Fast-Cat</label><br>


                </div>

                   